{"version":3,"sources":["webpack://Editor/./src/DirectEdit.svelte","webpack://Editor/./src/Editor.svelte","webpack://Editor/./src/App.svelte"],"names":[],"mappings":"AAmEI,wCAAa,aACK,CACd,iBAAkB,CAClB,KAAM,CACN,QAAS,CACT,OAAQ,CACR,MAAO,CACP,UAAW,CACd,8CACkB,iBACG,CAClB,qBAAsB,CACtB,YAAa;AA9ErB,qkGAAqkG,C;ACyPjkG,4CAAe,iBACO,CAClB,UAAW,CACX,WAAY,CACZ,eAAgB,CAChB,wCAAyC,CAC5C,0CAEY,iBACS,CAClB,WAAY,CACZ,UAAW,CAEX,iBAAkB,CAClB,gBAAiB,CACjB,2BAA4B,CAC/B,0CAEY,WACG,CACZ,WAAY,CACf,0CAEY,oBACY,CACxB,wCAEU,gBACU;AArRzB,y8bAAy8b,C;ACE77b,UAAY,WACJ,CACZ,QAAS,CACT,SAAU;AALlB,ikBAAikB,C","file":"styles.css","sourcesContent":["<script>\n    import { createEventDispatcher } from \"svelte\";\n\n    const dispatcher = createEventDispatcher();\n\n    let inputEl;\n    let opened = false;\n    let inputValue = \"\";\n    let x = 0;\n    let y = 0;\n    let w = 0;\n    let h = 0;\n\n    export function start(command) {\n        if (command) {\n            opened = true;\n            inputValue = command.value;\n            x = command.bounds.x;\n            y = command.bounds.y;\n            w = command.bounds.width;\n            h = command.bounds.height;\n        } else {\n            opened = false;\n        }\n    }\n\n    function close() {\n        opened = false;\n    }\n\n    function initInput(el) {\n        el.select();\n        el.focus();\n    }\n\n    function keyup(ev) {\n        if (ev.keyCode == 27) {\n            dispatcher(\"change\", { status: false, text: \"\" });\n            close();\n        } else if (ev.keyCode == 13) {\n            dispatcher(\"change\", { status: true, text: inputValue });\n            close();\n        }\n    }\n\n    function mouseUp(ev) {\n        if (ev.target !== inputEl) {\n            dispatcher(\"change\", { status: false, text: \"\" });\n            close();\n        }\n    }\n</script>\n\n{#if opened}\n    <div class=\"directEdit\" on:mouseup={mouseUp}>\n        <input\n            bind:value={inputValue}\n            bind:this={inputEl}\n            style=\"left: {x}px; top: {y}px; width: {w}px; height: {h}px\"\n            type=\"text\"\n            use:initInput\n            on:keyup={keyup}\n        />\n    </div>\n{/if}\n\n<style>\n    .directEdit {\n        display: block;\n        position: absolute;\n        top: 0;\n        bottom: 0;\n        right: 0;\n        left: 0;\n        z-index: 10;\n    }\n    .directEdit input {\n        position: absolute;\n        border: solid 1px gray;\n        outline: none;\n    }\n</style>\n","<script>\n    import { onMount } from 'svelte';\n    import Fa from 'svelte-fa';\n    import { faUndo, faRedo } from '@fortawesome/free-solid-svg-icons';\n    import { CommandStack } from './command';\n    import { Point } from './geometry';\n    import { createModel, createLifeLine, AddLifeLineCommand } from './model';\n    import { Renderer } from './renderer';\n    import { DiagramContext, IdleState } from './states';\n    import DirectEdit from \"./DirectEdit.svelte\";\n\n    let width;\n    let height;\n    let context;\n\n    let directEditComponent;\n    let currentEditDefer;\n\n    let model;\n    let commandStack;\n    let renderer;\n    let state;\n    let diagramContext;\n\n    let view = {\n        lifeLines: [],\n        messages: [],\n        tools: [],\n        pendingMessage: null\n    };\n    let paletteState = {\n        canUndo: false,\n        canRedo: false\n    }\n\n    const style = {\n        lifeLineHeadTextSize: \"24px\",\n        lifeLineHeadMargin: 10,\n        minHeadHeight: 60,\n        topMargin: 20,\n        leftMargin: 20,\n        minHeadGap: 20,\n        messageTextSize: \"18px\",\n        messageStartGap: 80,\n        messageGap: 60,\n        messageMargin: 15\n    };\n\n    // TODO move to utils\n    function defer() {\n        const deferred = {};\n        const promise = new Promise((resolve, reject) => {\n            deferred.resolve = resolve;\n            deferred.reject  = reject;\n        });\n        deferred.promise = promise;\n        return deferred;\n    }\n\n    onMount(() => {\n        const canvas = document.createElement(\"canvas\");\n        context = canvas.getContext(\"2d\");\n\n        model = createModel();\n\n        renderer = new Renderer(style, {\n            measure: measureText\n        });\n\n        commandStack = new CommandStack();\n\n        diagramContext = new DiagramContext(commandStack, model, renderer, (v) => {\n            view = v;\n            paletteState = {\n                canUndo: commandStack.canUndo(),\n                canRedo: commandStack.canRedo()\n            };\n        },\n        (directEdit) => {\n            currentEditDefer = defer();\n            directEditComponent.start(directEdit)\n            return currentEditDefer.promise;\n         });\n        \n        state = new IdleState(diagramContext);\n\n        diagramContext.refresh(true);\n    });\n\n    function changeDirectEdit(e) {\n        if (e.detail.status) {\n            currentEditDefer.resolve(e.detail.text);\n        } else {\n            currentEditDefer.reject({});\n        }\n    }\n    \n    function measureText(text, textSize) {\n        context.font = textSize + \" arial\";\n        const metrics = context.measureText(text);\n        return metrics;\n    }\n\n    function mouseDown(e) {\n        const mousePoint = new Point(e.clientX, e.clientY)\n        state = state.mouseDown(mousePoint);\n    }\n\n    function mouseUp(e) {\n        const mousePoint = new Point(e.clientX, e.clientY)\n        state = state.mouseUp(mousePoint);\n    }\n\n    function mouseMove(e) {\n        const mousePoint = new Point(e.clientX, e.clientY)\n        state = state.mouseMove(mousePoint);\n    }\n\n    function undoAction() {\n        commandStack.undo();\n        diagramContext.refresh(true);\n    }\n\n    function redoAction() {\n        commandStack.redo();\n        diagramContext.refresh(true);\n    }\n\n    function addLifeLineAction() {\n        commandStack.execute(new AddLifeLineCommand(model, createLifeLine()));\n        diagramContext.refresh(true);\n    }\n\n</script>\n\n<div class=\"container\" bind:clientWidth={width} bind:clientHeight={height}>\n    <div on:mousedown={mouseDown} on:mouseup={mouseUp} on:mousemove={mouseMove}>\n    <svg {width} {height} viewBox=\"0 0 {width} {height}\">\n        <defs>\n            <marker id=\"triangle\" viewBox=\"0 0 10 10\"\n                  refX=\"10\" refY=\"5\"\n                  markerUnits=\"strokeWidth\"\n                  markerWidth=\"10\" markerHeight=\"10\"\n                  orient=\"auto-start-reverse\">\n                <path d=\"M 0 0 L 10 5 L 0 10 z\" fill=\"black\"/>\n            </marker>\n        </defs>\n        <style>\n            .select-marker {\n                stroke: none;\n            }\n            .select-marker.hover {\n                stroke: #55CCFF;\n            }\n            .select-marker.selected {\n                stroke: #55CC99;\n            }\n            .point-marker {\n                fill: none;\n            }\n            .point-marker.hover {\n                fill: #55CCFF;\n            }\n            .tool rect {\n                stroke: #CCCCCC;\n            }\n            .tool.hover rect {\n                stroke: #55CCFF;\n            }\n        </style>\n        {#each view.lifeLines as lifeLine}\n        <g transform=\"translate({lifeLine.x},{lifeLine.y})\">\n            <rect width=\"{lifeLine.width}\" height=\"{lifeLine.headHeight}\" stroke=\"black\" fill=\"none\"/>\n            <text dx={lifeLine.width/2} dy={lifeLine.textDy} text-anchor=\"middle\" font-size=\"{lifeLine.text.size}\">{lifeLine.text.value}</text>\n            <line x1={lifeLine.width/2} y1={lifeLine.headHeight}\n                x2={lifeLine.width/2} y2={lifeLine.headHeight + lifeLine.lineHeight}\n                stroke-dasharray=\"4\"\n                stroke=\"black\"/>\n            <rect class=\"select-marker\" class:hover={!lifeLine.selected && lifeLine.hover} class:selected={lifeLine.selected}\n                    x={-10} y={-10} rx=\"10\" ry=\"10\"\n                    width={lifeLine.markerBounds.width} height={lifeLine.markerBounds.height}\n                    fill=\"none\" stroke-dasharray=\"4\" stroke-width=\"2\"/>\n        </g>\n        {/each}\n        \n        {#each view.messages as message}\n        {#if !message.editing}\n        <g>\n            <line x1={message.from.lifeLine.centerX()} y1={message.y}\n                x2={message.to.lifeLine.centerX()} y2={message.y} stroke=\"black\" marker-end=\"url(#triangle)\"/>\n            {#if message.reversed}\n            <text x={message.to.lifeLine.centerX()+style.messageMargin} y={message.y-7} text-anchor=\"start\" font-size=\"{message.text.size}\">{message.text.value}</text>\n            {:else}\n            <text x={message.to.lifeLine.centerX()-style.messageMargin} y={message.y-7} text-anchor=\"end\" font-size=\"{message.text.size}\">{message.text.value}</text>\n            {/if}\n            <circle class=\"point-marker\" class:hover={message.from.hover}\n                cx={message.from.center().x} cy={message.from.center().y} r=\"6\" />\n            <circle class=\"point-marker\" class:hover={message.to.hover}\n                cx={message.to.center().x} cy={message.to.center().y} r=\"6\" />\n            <rect class=\"select-marker\" class:hover={!message.selected && message.hover} class:selected={message.selected}\n                    x={message.markerBounds.x} y={message.markerBounds.y}\n                    width={message.markerBounds.width} height={message.markerBounds.height}\n                    rx=\"10\" ry=\"10\" fill=\"none\" stroke-dasharray=\"4\" stroke-width=\"2\" />\n        </g>\n        {/if}\n        {/each}\n        {#if view.startMessageHandle}\n        <circle class=\"point-marker hover\" cx={view.startMessageHandle.position.x} cy={view.startMessageHandle.position.y} r=\"6\" />\n        {/if}\n        {#if view.pendingMessage}\n        <line x1={view.pendingMessage.from} y1={view.pendingMessage.y}\n                x2={view.pendingMessage.to} y2={view.pendingMessage.y} fill=\"none\" stroke=\"black\" marker-end=\"url(#triangle)\" />\n            {#if view.pendingMessage.hoverOther}\n            <circle class=\"point-marker hover\" cx={view.pendingMessage.hoverOther.centerX()} cy={view.pendingMessage.y} r=\"6\" />\n            {/if}\n        {/if}\n        {#if view.pendingLifeLine}\n        <line x1={view.pendingLifeLine.x} y1={view.pendingLifeLine.y}\n            x2={view.pendingLifeLine.x} y2={view.pendingLifeLine.y + view.pendingLifeLine.height}\n            stroke-dasharray=\"4\"\n            stroke-width={view.pendingLifeLine.snap ? 3 : 1}\n            stroke={view.pendingLifeLine.snap ? \"green\" : \"#55CCFF\"}/>\n        {/if}\n        {#each view.tools as tool}\n            <g transform=\"translate({tool.bounds.x},{tool.bounds.y})\" class=\"tool\" class:hover={tool.hover}>\n                <rect rx=\"5\" ry=\"5\" width={tool.bounds.width} height={tool.bounds.height} fill=\"white\"></rect>\n                <g transform=\"translate(4,3) scale({20.0/512})\">\n                    <path d={tool.tool.icon} />\n                </g>\n            </g>\n        {/each}\n    </svg>\n    </div>\n    <DirectEdit bind:this={directEditComponent} on:change={changeDirectEdit} />\n    <div class=\"palette\">\n        <ul>\n            <li>\n                <button disabled={!paletteState.canUndo} on:click={undoAction} title=\"Undo\"><Fa icon={faUndo}/></button>\n            </li>\n            <li>\n                <button disabled={!paletteState.canRedo} on:click={redoAction} title=\"Redo\"><Fa icon={faRedo}/></button>\n            </li>\n            <li class=\"spacer\">\n                <button on:click={addLifeLineAction}>Add LifeLine</button>\n            </li>\n        </ul>\n    </div>\n</div>\n\n<style>\n    div.container {\n        position: relative;\n        width: 100%;\n        height: 100%;\n        overflow: hidden;\n        font-family: Arial, Helvetica, sans-serif;\n    }\n\n    div.palette {\n        position: absolute;\n        bottom: 20px;\n        left: 100px;\n        /* border: 1px solid black; */\n        border-radius: 5px;\n        background: white;\n        box-shadow: 2px 2px 5px gray;\n    }\n\n    .palette ul {\n        padding: 0px;\n        margin: 10px;\n    }\n\n    .palette li {\n        display: inline-block;\n    }\n\n    li.spacer {\n        margin-left: 10px;\n    }\n</style>\n","<Editor />\n\n<style>\n    :global(html,body) {\n        height: 100%;\n        margin: 0;\n        padding: 0;\n    }\n</style>\n\n<script>\n    import Editor from './Editor';\n</script>"],"sourceRoot":""}